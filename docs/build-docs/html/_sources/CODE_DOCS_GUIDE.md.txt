# Code Documentation Integration Guide

## How It Works

Your documentation setup uses a **3-step pipeline** to get C++ code documentation (Doxygen comments) into your Sphinx website:

### The Pipeline

```
C++ Code with Doxygen Comments
         ↓
    [Doxygen]  ← Parses your code, extracts comments
         ↓
    XML Files  ← Structured representation of your API
         ↓
    [Breathe]  ← Reads XML, converts to Sphinx directives
         ↓
    [Exhale]   ← Auto-generates API hierarchy/tree structure
         ↓
    [Sphinx]   ← Combines with your .rst files
         ↓
    HTML Website ← Final documentation with code docs integrated!
```

### Components

1. **Doxygen** - Parses your C++ code and extracts documentation comments
   - Scans `plugin/source/` for `.h` and `.cpp` files
   - Looks for comments like `/** ... */` with `@brief`, `@param`, etc.
   - Generates XML files in `doxygen/xml/` directory

2. **Breathe** - Bridge between Doxygen XML and Sphinx
   - Reads the XML files generated by Doxygen
   - Converts them to Sphinx directives (like `.. doxygenclass::`, `.. doxygenfunction::`)
   - Already configured in `conf.py`

3. **Exhale** - Auto-generates API documentation structure
   - Automatically creates a hierarchical tree of all your classes, functions, namespaces
   - Generates `.rst` files in the `api/` directory
   - Creates a nice navigation structure
   - Already configured in `conf.py`

4. **Sphinx** - Your documentation framework
   - Takes your `.rst` files + the auto-generated API docs
   - Produces the final HTML website

## Current Setup Status

✅ **Doxygen** - Installed and configured (`/opt/homebrew/bin/doxygen`)
✅ **Breathe** - Installed (v4.36.0)
✅ **Exhale** - Installed (v0.3.7)
✅ **Code Comments** - Your code already has Doxygen comments!
✅ **Configuration** - `conf.py` is set up with Breathe and Exhale

## Building the Documentation

You have **two ways** to build the docs:

### Option 1: Using CMake (Recommended - Automated)

The `docs/CMakeLists.txt` automates the entire process:

```bash
cd docs
cmake -S . -B build
cmake --build build --target docs
```

This will:
1. Run Doxygen to generate XML
2. Run Exhale to generate API hierarchy
3. Run Sphinx to build the HTML
4. Output will be in `docs/build/html/`

### Option 2: Manual Step-by-Step

If you want more control or to debug issues:

```bash
cd docs

# Step 1: Generate Doxygen XML
doxygen Doxyfile
# Creates: doxygen/xml/ directory with XML files

# Step 2: Generate Sphinx docs (Breathe/Exhale run automatically)
sphinx-build -b html . _build/html

# Step 3: View the docs
open _build/html/index.html  # macOS
# or just navigate to _build/html/index.html in your browser
```

## Viewing the API Documentation

Once built, the API documentation will appear in your website under:

- **Navigation**: Look for "API Reference" in the sidebar
- **Direct link**: `/api/library_root.html` (or just click "API Reference" in the table of contents)
- **Structure**: Exhale creates a hierarchical tree showing:
  - Namespaces
  - Classes (with all methods, members)
  - Functions
  - All organized by namespace/header file

## How to Write Doxygen Comments

Your code already has good examples! Here's the format:

### Classes

```cpp
/**
 * ClassName - Brief description
 *
 * Detailed description can go here. This is where you explain
 * what the class does, how to use it, etc.
 */
class ClassName {
    // ...
};
```

### Functions/Methods

```cpp
/**
 * Brief description of what the function does
 * @param paramName Description of the parameter
 * @return Description of what is returned
 */
void myFunction(int paramName);
```

### Parameters and Return Values

```cpp
/**
 * Load audio buffer for playback
 * @param buffer The audio buffer to play (copied internally)
 * @param sampleRate The sample rate of the buffer
 */
void loadBuffer(const juce::AudioBuffer<float>& buffer, double sampleRate);
```

## Configuration Files

- **`Doxyfile`** - Doxygen configuration (tells Doxygen what to scan, what format, etc.)
- **`conf.py`** - Sphinx configuration (already has Breathe and Exhale configured)
- **`docs/CMakeLists.txt`** - Build automation (runs everything in the right order)

## Troubleshooting

### "Doxygen XML not found" errors

- Make sure Doxygen has run and generated `doxygen/xml/index.xml`
- Check that `conf.py` is pointing to the right path (it auto-detects)

### API docs not showing up

- Make sure Exhale ran successfully (check for generated files in `api/` directory)
- Verify your code has Doxygen comments
- Check Sphinx build logs for errors

### Rebuilding after code changes

Just rebuild! The pipeline will:
1. Re-parse your code with Doxygen
2. Re-generate the XML
3. Re-generate the API docs
4. Re-build the website

**Important:** After renaming classes or files, you MUST rebuild the documentation:
```bash
cd docs
rm -rf build-docs doxygen api  # Clean old generated files
cmake -S . -B build-docs
cmake --build build-docs --target docs
```

### Doxygen comments not showing in browser

If you've added Doxygen comments but they're not appearing in the Sphinx docs:

1. **Verify comments are in correct format:**
   ```cpp
   /** Brief description
    * @param paramName Description
    * @return Description
    */
   ```

2. **Check Doxygen extracted them:**
   - Look in `doxygen/xml/` for XML files
   - Search for your class/function name in the XML
   - Verify the `<detaileddescription>` tags contain your comments

3. **Rebuild completely:**
   ```bash
   cd docs
   rm -rf build-docs doxygen api _build
   cmake -S . -B build-docs
   cmake --build build-docs --target docs
   ```

4. **Check Sphinx build logs** for warnings about missing documentation

## Next Steps

1. **Build the docs** using one of the methods above
2. **Check the output** - look for "API Reference" in your website
3. **Explore** - click through to see your classes and functions documented
4. **Add more comments** - as you write new code, add Doxygen comments and they'll automatically appear!

The beauty of this setup is that once it's working, you just write Doxygen comments in your code and they automatically appear in your website alongside your narrative documentation (`.rst` files).
